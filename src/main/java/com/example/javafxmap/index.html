<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<div class="map_box">
    <div class="map_img right">
        <style>
            #map {
                width: 100%;
                height: 500px;
            }
        </style>
        <div id="map"></div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=171192349e78334c4e8341e7212c59da&libraries=clusterer,services"></script>
        <script>
            // map
            var map;
                var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                    mapOption = {
                        center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                        level: 3 // 지도의 확대 레벨
                    };
                // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
                map = new kakao.maps.Map(mapContainer, mapOption);
        </script>
    </div>
    <!-- //map_img -->

    <div class="course_all">
        <div class="course_all_top">
            <h3>
                데이터 지도 보기
            </h3>
            <label for="search" class="blind">검색</label>
            <input id="search" name="searchMap" type="text" placeholder="주소 또는 명칭으로 검색하실 수있습니다." />

            <ul class="search_list clearfix">
                <li class="tourism">
                    <a href="/petapi/data/tour">
                        <span>관광</span>
                    </a>
                </li>
                <li class="lodgment">
                    <a href="/petapi/data/lodge">
                        <span>숙박</span>
                    </a>
                </li>
                <li class="beverage">
                    <a href="/petapi/data/food">
                        <span>식음료</span>
                    </a>
                </li>
                <li class="experience">
                    <a href="/petapi/data/experience">
                        <span>체험</span>
                    </a>
                </li>
                <li class="animal_hospital">
                    <a href="/petapi/data/hospital">
                        <span>동물병원</span>
                    </a>
                </li>
            </ul>
            <!-- //search_list -->
        </div>
        <!-- //course_all_top -->

        <div class="course_all_box choose-filed">
            <strong>주변 탐색</strong>
            <ul>
                <li>
                    <input type="checkbox" id="tourist_destination" name="partCode" value="PC03" checked>
                    <label for="tourist_destination">관광지</label>
                </li>
                <li>
                    <input type="checkbox" id="lodgment" name="partCode" value="PC02" checked>
                    <label for="lodgment">숙박</label>
                </li>
                <li>
                    <input type="checkbox" id="beverage" name="partCode" value="PC01" checked>
                    <label for="beverage">식음료</label>
                </li>
                <li>
                    <input type="checkbox" id="experience" name="partCode" value="PC04" checked>
                    <label for="experience">체험</label>
                </li>
                <li>
                    <input type="checkbox" id="animal_hospital" name="partCode" value="PC05" checked>
                    <label for="animal_hospital">동물병원</label>
                </li>
            </ul>
        </div>
        <!-- //course_all_box -->

        <div class="btn_box01">
            <button class="btn_open"><span class="blind">댕댕여지도 검색 열기</span></button>
            <button class="btn_close"><span class="blind">댕댕여지도 검색 닫기</span></button>
        </div>
        <!-- //btn3 -->

    </div>
    <!-- //course_all -->
</div>
<script>
    $(document).ready(function (event) {
        var params = {
            areaCode : "",
            partCode : "",
            searchKeywordTo : ""
        };

        fnCreateMap(params);

        // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
        var mapTypeControl = new kakao.maps.MapTypeControl();
        // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
        // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

        // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
        var zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

        // keyword enter key
        $("input[name='searchMap']").keypress(function (event) {
            if(event.keyCode == 13) {
                $("input[name='partCode']").prop("checked", true);
                var params = {
                    searchKeywordTo : $(this).val()
                };
                fnCreateMap(params);
            }
        });

        // select part code
        $("input[name='partCode']").click(function (event) {
            if($(this).is(":checked")) {
                setupMarkers(map, $(this).val());
            } else {
                setupMarkers(null, $(this).val());
            }
        });
    });

    // add an markers
    function addMarker(_position) {
        var imageSrc = "/page/portal/images/common/icon_map_" + _position.partCode + ".png";
        // 마커 이미지의 이미지 크기 입니다
        var imageSize = new kakao.maps.Size(30, 35);
        // 마커 이미지를 생성합니다
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: new kakao.maps.LatLng(_position.latitude, _position.longitude), // 마커를 표시할 위치
            image : markerImage, // 마커 이미지
            clickable: true, // 마커를 클릭했을 때 지도의 클릭 이벤트가 발생하지 않도록 설정합니다
            title : _position.title
        });

        // 마커를 클릭했을 때 커스텀 오버레이를 표시합니다
        kakao.maps.event.addListener(marker, 'click', function() {
            var content = "";
            if("PC05" == _position.partCode) {
                content = "" +
                    "<div class=\"map_popup\">\n" +
                    "   <strong>\n" +
                    "       " + _position.title + "\n" +
                    "   </strong>\n" +
                    "   <p>\n" +
                    "       " + _position.address + "\n" +
                    "   </p>\n" +
                    "   <button class=\"pop_close\" onclick=\"closeOverlay(" + _position.seq + ")\"><span class=\"blind\">팝업닫기</span></button>\n" +
                    "</div>";

            } else {
                content = "" +
                    "<div class=\"map_popup\">\n" +
                    "   <strong>\n" +
                    "       " + _position.title + "\n" +
                    "   </strong>\n" +
                    "   <div class=\"img_box\">\n" +
                    "       <img src='" + _position.image + "' alt='" + _position.title + "'>\n" +
                    "   </div>\n" +
                    "   <p>\n" +
                    "       " + _position.address + "\n" +
                    "   </p>\n" +
                    "   <a href=\"javascript:fnViewContent('" + _position.partCode + "\', " + _position.seq + ")\" style='width:100%;'>상세보기</a>\n" +
                    "   <button class=\"pop_close\" onclick=\"closeOverlay(" + _position.seq + ")\"><span class=\"blind\">팝업닫기</span></button>\n" +
                    "</div>";
            }

            // initial view content
            $(".map_popup").remove();
            // move map center
            map.setCenter(marker.getPosition());

            // 마커 위에 커스텀오버레이를 표시합니다
            // 마커를 중심으로 커스텀 오버레이를 표시하기위해 CSS를 이용해 위치를 설정했습니다
            var overlay = new kakao.maps.CustomOverlay({
                position: marker.getPosition(),
                content: content,
                zIndex: 100
            });

            // save overlay value
            overlayArray[_position.seq] = overlay;

            // disable zoom
            //map.setZoomable(false);
            // disable move
            //map.setDraggable(false);
            // setup overlay
            overlay.setMap(map);
        });

        // 마커가 지도 위에 표시되도록 설정합니다
        marker.setMap(map);

        return marker;
    }

    // view content
    function fnViewContent(_code, _seq) {
        var codeName = "";
        if("PC02" == _code) {
            codeName = "lodge";
        } else if("PC03" == _code) {
            codeName = "tour";
        } else if("PC01" == _code) {
            codeName = "food";
        } else if("PC04" == _code) {
            codeName = "experience";
        } else if("PC05" == _code) {
            codeName = "hospital";
        }
        location.href = "/petapi/data/" + codeName + "?contentSeq=" + _seq;
    }
</script>





</body>
</html>
